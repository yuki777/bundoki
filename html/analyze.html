<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>ゴキゲン分度器</title>
        <meta name="description" content="あなたのツイートからゴキゲン度合いを分析して表示します">
        <meta name="author" content="<?php echo SITE_AUTHOR; ?>">

        <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- Le styles -->
        <link href="css/bootstrap.css" rel="stylesheet">
        <style type="text/css">
            body {
                padding-top: 60px;
            }
        </style>

        <!-- Le fav and touch icons -->
        <link rel="shortcut icon" href="images/favicon.ico">
        <link rel="apple-touch-icon" href="images/tora57x57.jpg">
        <link rel="apple-touch-icon" sizes="72x72" href="images/tora72x72.jpg">
        <link rel="apple-touch-icon" sizes="114x114" href="images/tora114x114.jpg">

        <!-- jquery -->
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>

        <!-- loading animation jquery plugin -->
        <!-- http://neteye.github.com/activity-indicator.html -->
        <script src="js/loading/jquery.activity-indicator-1.0.0.js" /></script>
        <style type="text/css">
        .loading {
            width: 200;
            height: 200;
            float: left;
            margin: 10px;
            padding: 10px 10px;
            color: #000;
            background: whiteSmoke;
            font-family: Helvetica, Arial, Sans-Serif;
        }
        </style>
        <!-- loading animation jquery plugin -->


    </head>

    <body>

        <div class="topbar">
            <div class="fill">
                <div class="container">
                    <a class="brand" href="/">ゴキゲン分度器</a>
                    <ul class="nav">
                        <li class="active"><a href="/">Home</a></li>
                        <li><a href="#about">About</a></li>
                        <li><a href="#contact">Contact</a></li>
                        <?php if($is_login) echo '<li><a href="clearsessions.php">logout</a></li>'; ?>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">

            <!-- Main hero unit for a primary marketing message or call to action -->
            <div class="hero-unit">
                <h1>ゴキゲンいかが？</h1>

                <p></p>

                <!-- ローディングアニメーション -->
                <div id="busy" class="loading"></div>

                <!-- 結果メッセージ -->
                <div id="message"></div>

                <!-- tweetしよう -->
                <div id="lets_tweet">
                    <p><a target="_brank" href="https://twitter.com/intent/tweet?text=+<?php echo urlencode($message); ?>++">結果をTwitterでつぶやこう</a></p>
                </div>

            </div>

            <!-- ユーザツイートリスト -->
            <div class="alert-message block-message warning">
                <div id="status_list">
                    <ul>
                    </ul>
                </div>
            </div>

            <!-- 感情解析結果 --> 
            <div class="alert-message block-message warning">
                <div id="emotion_point">
                    <ul>
                    </ul>
                </div>
            </div>

            <footer><p>&copy; <?php echo SITE_URL;?> 2011</p></footer>

        </div> <!-- /container -->

        <?php include('html/google_analytics.html'); ?>

        <script>
            $(document).ready(function () {
                // tweetメッセージがまだ取得出来ていないので隠しておく
                $('#lets_tweet').css('display', 'none');
                // ローディングアニメーション
                $('#busy').activity({segments: 12, width: 5.5, space: 6, length: 13, color: '#252525', speed: 5.5});
                // ユーザツイートリストを取得＋セット
                set_status_list();
                // 感情解析結果を取得＋セット
                set_emotion_point();
                // 結果メッセージを取得＋セット
                set_message();
                // tweetメッセージを取得＋セット
                set_tweet_link();
            });
            function set_status_list(){
                var xhr = new XMLHttpRequest();
                var url = '/proxy/mode/get_user_status_list/';
                xhr.open('GET', url, true);
                xhr.onreadystatechange = function() {
                    if(xhr.readyState === 4 && xhr.status == 200) {
                        var json = $.parseJSON(xhr.responseText);
                        for(var i in json) {
                            var li = '<li>' + json[i] + '</li>';
                            $("#status_list ul").append(li);
                        }
                    }
                };
                xhr.send(null);
            }
            function set_emotion_point(){
                var xhr = new XMLHttpRequest();
                var url = '/proxy/mode/get_emotion_point/';
                xhr.open('GET', url, true);
                xhr.onreadystatechange = function() {
                    if(xhr.readyState === 4 && xhr.status == 200) {
                        var json = $.parseJSON(xhr.responseText);
                        $("#emotion_point ul").append('<li>total_emotion : ' + json.total_emotion + '</li>');
                        $("#emotion_point ul").append('<li>total_positive : ' + json.total_positive + '</li>');
                        $("#emotion_point ul").append('<li>total_negative : ' + json.total_negative + '</li>');
                        $("#emotion_point ul").append('<li>total_unknown : ' + json.total_unknown + '</li>');
                        $("#emotion_point ul").append('<li>total_text : ' + json.total_text + '</li>');
                    }
                };
                xhr.send(null);
            }
            function set_message(){
                var xhr = new XMLHttpRequest();
                var url = '/proxy/mode/get_message/';
                xhr.open('GET', url, true);
                xhr.onreadystatechange = function() {
                    if(xhr.readyState === 4 && xhr.status == 200) {
                        var json = $.parseJSON(xhr.responseText);
                        //$("#message ul").append('<li>' + json + '</li>');
                        $('#message').html('<p>' + json + '</p>');
                    }
                };
                xhr.send(null);
            }
            function set_tweet_link(){
                var xhr = new XMLHttpRequest();
                var url = '/proxy/mode/get_tweet_link/';
                xhr.open('GET', url, true);
                xhr.onreadystatechange = function() {
                    if(xhr.readyState === 4 && xhr.status == 200) {
                        var json = $.parseJSON(xhr.responseText);
                        $('#lets_tweet a').attr('href' , json);
                        $('#lets_tweet').css('display', 'block');
                        $('#busy').activity(false);
                    }
                };
                xhr.send(null);
            }
        </script>

    </body>
</html>
